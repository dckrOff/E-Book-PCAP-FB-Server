# Документация администраторской панели электронного учебника PCAP

## Содержание

1. [Введение](#введение)
2. [Архитектура и технологии](#архитектура-и-технологии)
3. [Структура проекта](#структура-проекта)
4. [База данных](#база-данных)
5. [Компоненты](#компоненты)
6. [Типы контента](#типы-контента)
7. [Руководство по установке](#руководство-по-установке)
8. [Руководство пользователя](#руководство-пользователя)
9. [Руководство разработчика](#руководство-разработчика)
10. [Импорт и экспорт данных](#импорт-и-экспорт-данных)

## Введение

Админ-панель для электронного учебника PCAP (Параллельная архитектура компьютера и программирования) представляет собой веб-приложение, разработанное на React с использованием Firebase в качестве бэкенда. Приложение предназначено для управления содержимым электронного учебника, включая главы, разделы, глоссарий терминов, тесты и пользовательскую информацию.

Основные возможности:
- Управление структурой учебника (главы и разделы)
- Редактирование содержимого разделов с поддержкой различных типов контента
- Управление глоссарием терминов
- Создание и редактирование тестов
- Просмотр информации о пользователях
- Импорт/экспорт данных

## Архитектура и технологии

### Технологический стек

- **Frontend**:
  - React.js (версия 18.2.0)
  - React Router (версия 6.11.2) для навигации
  - CSS для стилизации (без фреймворков)

- **Backend**:
  - Firebase Firestore (версия 9.23.0) для базы данных
  - Firebase Storage для хранения медиафайлов
  - Firebase Authentication для авторизации (опционально)

- **Инструменты разработки**:
  - Node.js и npm для управления зависимостями
  - Create React App для настройки и сборки проекта

### Архитектура приложения

Приложение построено по принципу Single Page Application (SPA) с компонентной архитектурой React. Основная логика распределена по функциональным компонентам, каждый из которых отвечает за определенную часть функциональности.

Схема взаимодействия:
1. React-компоненты отображают интерфейс пользователя
2. Через Firebase SDK компоненты взаимодействуют с Firestore и Storage
3. Данные хранятся в Firestore в структурированном виде
4. Медиафайлы (изображения, видео) хранятся в Firebase Storage

## Структура проекта

```
src/
  ├── components/        # Компоненты React
  │   ├── Chapters/      # Управление главами
  │   ├── Sections/      # Управление разделами
  │   ├── Glossary/      # Управление глоссарием
  │   ├── Quizzes/       # Управление тестами
  │   ├── Users/         # Управление пользователями
  │   ├── Content/       # Редактор контента
  │   ├── Dashboard.js   # Главная панель управления
  │   ├── Sidebar.js     # Боковое меню
  │   └── Header.js      # Верхняя панель
  ├── firebase.js        # Конфигурация Firebase
  ├── App.js             # Главный компонент приложения
  ├── index.js           # Точка входа
  ├── index.css          # Глобальные стили
  └── App.css            # Стили приложения
```

## База данных

### Структура Firestore

База данных Firestore организована следующим образом:

1. **Главы (chapters)**
   - Коллекция верхнего уровня
   - Каждая глава содержит вложенную коллекцию разделов

2. **Разделы (sections)**
   - Вложенная коллекция внутри главы
   - Содержит информацию о разделе и ссылку на контент

3. **Контент (content)**
   - Коллекция для хранения содержимого разделов
   - Организована по принципу: `content/{chapterId}/sections/{sectionId}`

4. **Глоссарий (glossary)**
   - Коллекция для хранения терминов и их определений

5. **Тесты (quizzes)**
   - Коллекция с тестами и вопросами

6. **Пользователи (users)**
   - Информация о пользователях системы и их прогрессе

7. **Закладки (bookmarks)**
   - Пользовательские закладки

### Схема данных

Детальная схема данных представлена в файле `db_strukture_real.md`. Вот основные структуры:

```javascript
// Глава
{
  id: string,            // уникальный идентификатор
  title: string,         // название главы
  order: number,         // порядок отображения
  sectionsCount: number  // количество разделов (опционально)
}

// Раздел
{
  id: string,            // уникальный идентификатор
  title: string,         // название раздела
  description: string,   // описание
  order: number,         // порядок отображения
  progress: number,      // прогресс выполнения (0-100%)
  contentUrl: string,    // ссылка на контент
  chapterId: string      // ID родительской главы
}

// Контент раздела
{
  id: string,            // ID раздела
  title: string,         // заголовок раздела
  content: array         // массив элементов контента
}

// Термин глоссария
{
  id: string,            // уникальный идентификатор
  term: string,          // термин
  definition: string,    // определение
  category: string,      // категория (опционально)
  relatedTerms: array,   // связанные термины
  relatedSections: array // связанные разделы
}

// Тест
{
  id: string,            // уникальный идентификатор
  title: string,         // название теста
  description: string,   // описание
  difficulty: string,    // сложность (easy, medium, hard)
  timeLimit: number,     // ограничение времени в минутах
  questions: array       // массив вопросов
}
```

## Компоненты

### Dashboard (Панель управления)

Центральный компонент, отображающий статистику и быстрые действия для администратора.

- **Функциональность**:
  - Отображение общей статистики (количество глав, разделов, терминов и т.д.)
  - Быстрые ссылки для создания новых элементов
  - Обзор последних изменений

### ChapterList и ChapterForm

Компоненты для управления главами учебника.

- **ChapterList**: отображает список всех глав с возможностью сортировки, редактирования и удаления.
- **ChapterForm**: форма для создания и редактирования глав.

### SectionList и SectionForm

Компоненты для управления разделами глав.

- **SectionList**: отображает список разделов с возможностью фильтрации по главам.
- **SectionForm**: форма для создания и редактирования разделов.

### ContentEditor

Ключевой компонент для редактирования содержимого разделов с поддержкой различных типов контента.

- **Функциональность**:
  - Добавление, удаление и перемещение элементов контента
  - Редактирование различных типов контента (текст, код, формулы, таблицы, изображения, видео, диаграммы)
  - Предварительный просмотр изображений и видео
  - Сохранение изменений в Firestore

### GlossaryList и GlossaryForm

Компоненты для управления глоссарием терминов.

- **GlossaryList**: отображает список терминов с возможностью поиска и фильтрации.
- **GlossaryForm**: форма для создания и редактирования терминов.

### QuizList, QuizForm и QuestionForm

Компоненты для управления тестами и вопросами.

- **QuizList**: отображает список тестов.
- **QuizForm**: форма для создания и редактирования тестов.
- **QuestionForm**: форма для создания и редактирования вопросов теста.

### UserList и UserForm

Компоненты для управления пользователями.

- **UserList**: отображает список пользователей с их прогрессом.
- **UserForm**: форма для просмотра и редактирования информации о пользователе.

## Типы контента

Редактор контента поддерживает семь типов контента:

### 1. Текстовый контент (text)

Базовые текстовые блоки с возможностью выделения.

**Поля данных**:
- `content`: текстовое содержимое
- `isHighlighted`: флаг выделения

### 2. Код (code)

Блоки с кодом различных языков программирования.

**Поля данных**:
- `content`: код
- `language`: язык программирования
- `caption`: подпись к коду

### 3. Формулы (formula)

Математические формулы в формате LaTeX.

**Поля данных**:
- `content`: формула в формате LaTeX
- `caption`: подпись к формуле
- `isInline`: флаг встроенного отображения

### 4. Таблицы (table)

Табличные данные с настраиваемыми заголовками и строками.

**Поля данных**:
- `headers`: массив заголовков столбцов
- `rows`: двумерный массив ячеек
- `caption`: подпись к таблице

### 5. Изображения (image)

Изображения с URL-ссылками.

**Поля данных**:
- `url`: ссылка на изображение
- `caption`: подпись к изображению
- `description`: альтернативный текст (alt)

### 6. Видео (video)

Видеоматериалы с URL-ссылками.

**Поля данных**:
- `url`: ссылка на видео
- `caption`: подпись к видео

### 7. Диаграммы (diagram)

Интерактивные блок-схемы и диаграммы.

**Поля данных**:
- `elements`: массив элементов диаграммы
  - `id`: идентификатор элемента
  - `type`: тип элемента (block, connector, decision)
  - `text`: текст элемента
  - `x`, `y`: координаты
  - `width`, `height`: размеры
  - `connections`: связи с другими элементами
- `caption`: подпись к диаграмме

## Руководство по установке

### Предварительные требования

- Node.js 14.x или выше
- NPM 6.x или выше
- Аккаунт Firebase

### Шаги по установке

1. **Клонирование репозитория**:
   ```
   git clone [URL репозитория]
   cd pcap-admin-panel
   ```

2. **Установка зависимостей**:
   ```
   npm install
   ```

3. **Настройка Firebase**:
   - Создайте проект в [Firebase Console](https://console.firebase.google.com/)
   - Включите Firestore Database и Storage
   - Создайте веб-приложение в проекте Firebase
   - Скопируйте настройки Firebase в файл `src/firebase.js`

4. **Обновление конфигурации Firebase**:
   Отредактируйте файл `src/firebase.js`, заменив placeholder-значения на ваши данные из Firebase Console:
   ```javascript
   const firebaseConfig = {
     apiKey: "ВАШ_API_KEY",
     authDomain: "ваш-проект.firebaseapp.com",
     projectId: "ваш-проект",
     storageBucket: "ваш-проект.appspot.com",
     messagingSenderId: "ВАШЕ_ЗНАЧЕНИЕ",
     appId: "ВАШЕ_ЗНАЧЕНИЕ"
   };
   ```

5. **Запуск приложения**:
   ```
   npm start
   ```

6. **Настройка правил безопасности Firestore**:
   ```
   rules_version = '2';
   service cloud.firestore {
     match /databases/{database}/documents {
       match /{document=**} {
         allow read, write: if true; // Для разработки, в производстве настроить правильные правила доступа
       }
     }
   }
   ```

## Руководство пользователя

### Навигация по приложению

1. **Главная панель (Dashboard)**: Отображает статистику и основные действия.
2. **Главы**: Управление главами учебника.
3. **Разделы**: Управление разделами учебника.
4. **Контент**: Редактирование содержимого разделов.
5. **Глоссарий**: Управление терминами и определениями.
6. **Тесты**: Создание и редактирование тестов.
7. **Пользователи**: Просмотр информации о пользователях.

### Управление главами и разделами

1. Для создания новой главы нажмите "Добавить главу" на странице глав.
2. Для создания нового раздела нажмите "Добавить раздел" на странице разделов.
3. Для редактирования главы или раздела нажмите соответствующую кнопку "Редактировать".
4. Для удаления главы или раздела нажмите "Удалить" (требуется подтверждение).

### Редактирование контента

1. Выберите раздел в списке разделов и нажмите "Редактировать контент".
2. В редакторе контента вы можете:
   - Добавлять различные типы контента (текст, код, формулы и т.д.)
   - Перемещать элементы контента вверх и вниз
   - Удалять элементы контента
   - Редактировать свойства каждого элемента

3. **Текстовый контент**: Введите текст и при необходимости отметьте "Выделить текст".
4. **Код**: Введите код, выберите язык программирования и добавьте подпись.
5. **Формула**: Введите формулу в формате LaTeX, добавьте подпись и выберите тип отображения.
6. **Таблица**: Настройте заголовки и ячейки таблицы, добавьте подпись.
7. **Изображение**: Введите URL изображения, добавьте подпись и альтернативный текст.
8. **Видео**: Введите URL видео и добавьте подпись.
9. **Диаграмма**: Создайте элементы диаграммы, настройте их свойства и связи.

### Управление глоссарием

1. Для добавления термина нажмите "Добавить термин" на странице глоссария.
2. Заполните поля "Термин", "Определение" и "Категория".
3. При необходимости добавьте связанные термины и разделы.

### Управление тестами

1. Для создания теста нажмите "Создать тест" на странице тестов.
2. Заполните информацию о тесте (название, описание, сложность, ограничение времени).
3. Добавьте вопросы, указав для каждого:
   - Текст вопроса
   - Тип вопроса (с одним вариантом ответа, с несколькими вариантами, правда/ложь)
   - Варианты ответов
   - Правильные ответы
   - Объяснение правильного ответа

## Руководство разработчика

### Структура компонентов

Приложение построено на функциональных компонентах React с использованием хуков. Каждый компонент выполняет конкретную функцию и может быть расширен или модифицирован.

### Добавление нового типа контента

Для добавления нового типа контента необходимо:

1. Обновить функцию `addContentItem` в компоненте `ContentEditor.js`:
   ```javascript
   case 'new_type':
     newItem.specificField1 = defaultValue1;
     newItem.specificField2 = defaultValue2;
     break;
   ```

2. Добавить обработку в функцию `renderContentItemEditor`:
   ```javascript
   case 'new_type':
     return (
       <div className="new-type-editor">
         {/* Форма редактирования нового типа */}
       </div>
     );
   ```

3. Обновить функцию `getContentTypeLabel`:
   ```javascript
   case 'new_type':
     return 'Название нового типа';
   ```

4. Добавить кнопку для создания нового типа контента:
   ```jsx
   <button 
     type="button" 
     className="btn btn-secondary" 
     onClick={() => addContentItem('new_type')}
   >
     Новый тип
   </button>
   ```

5. Обновить схему данных в `db_strukture_real.md`.

### Взаимодействие с Firebase

Все взаимодействия с Firestore происходят через Firebase SDK. Основные операции:

- **Создание документа**:
  ```javascript
  await addDoc(collection(db, 'collection_name'), data);
  // или
  await setDoc(doc(db, 'collection_name', documentId), data);
  ```

- **Чтение документа**:
  ```javascript
  const docRef = doc(db, 'collection_name', documentId);
  const docSnap = await getDoc(docRef);
  if (docSnap.exists()) {
    const data = docSnap.data();
    // Обработка данных
  }
  ```

- **Обновление документа**:
  ```javascript
  await updateDoc(doc(db, 'collection_name', documentId), {
    field1: newValue1,
    field2: newValue2
  });
  ```

- **Удаление документа**:
  ```javascript
  await deleteDoc(doc(db, 'collection_name', documentId));
  ```

- **Запросы**:
  ```javascript
  const q = query(
    collection(db, 'collection_name'), 
    where('field', '==', value),
    orderBy('anotherField', 'desc')
  );
  const querySnapshot = await getDocs(q);
  const items = querySnapshot.docs.map(doc => ({
    id: doc.id,
    ...doc.data()
  }));
  ```

### Стилизация компонентов

Стили компонентов находятся в соответствующих CSS-файлах (например, `ContentEditor.css`). Для модификации внешнего вида приложения достаточно отредактировать эти файлы.

## Импорт и экспорт данных

### Утилита импорта данных

Для импорта данных используется скрипт `dataUploader.js`. Он позволяет загружать структурированные данные из JSON-файла в Firestore и медиафайлы в Firebase Storage.

#### Использование:

```
node dataUploader.js path/to/data.json
```

#### Структура JSON-файла:

JSON-файл должен содержать следующие разделы (все они опциональны):
- `chapters`: массив глав
- `glossary`: массив терминов глоссария
- `quizzes`: массив тестов
- `quiz_results`: массив результатов тестов
- `users`: массив пользователей
- `bookmarks`: массив закладок
- `content`: объект с контентом разделов

### Обработка медиафайлов

Скрипт импорта также обрабатывает медиафайлы (изображения и видео):
1. Если URL начинается с "http", ссылка сохраняется как есть
2. Если URL указывает на локальный файл, он загружается в Firebase Storage
3. После загрузки URL в Firebase обновляется в Firestore

### Экспорт данных

Для экспорта данных необходимо создать отдельный скрипт, который будет:
1. Получать данные из Firestore
2. Структурировать их в формат, совместимый с импортом
3. Сохранять в JSON-файл

## Заключение

Админ-панель электронного учебника PCAP представляет собой гибкое и расширяемое решение для управления образовательным контентом. Благодаря модульной архитектуре и использованию современных технологий, приложение можно легко адаптировать под различные потребности и расширять новыми функциями.

В случае возникновения вопросов или необходимости в дополнительной информации обращайтесь к разработчикам проекта. 